var payload = {
	"2 - 16:00": { // Registration and Sponsorship Expo
		html: "<img src='assets/scotiabank.png' class='modal-img' alt='Scotiabank logo'><br>" +
		"<img src='assets/bcg-short.png' class='modal-img-small' alt='BCG logo'>" + 
		"<img src='assets/td.png' class='modal-img-small' alt='TD logo'><br><br>" +
		"<p>A welcome event where delegates are invited to register themselves, and then move on to the Sponsorship Expo.</p>" +
		"<p>The Sponsorship Expo is a chance for all delegates to meet and network with representatives from our sponsors and partners, as well as some of our speakers!</p>"
	},
	"2 - 17:30": { // Opening Remarks and Dinner
		text: "The co-chairs will address the conference while a catered buffet dinner catered by the Delta Waterfront Hotel is served.",
		doublesrc: true
	},
	"2 - 18:30": { // Speaker: Andy Shaughnessy
		text: "Andy is a partner in Torys' Litigation and Dispute Resolution Practice. His practice focuses on intellectual property litigation and Federal Court practice. Andy has represented a wide variety of clients in complex patent and trademark infringement and related litigation. He has been an advocate before the Supreme Court of Canada, the Federal Court of Appeal, the Federal Court, Court of Appeal for Ontario, Ontario Superior Court of Justice specialized tribunals such as the Patented Medicine Prices Review Board and the Trademarks Opposition Board. Andy is a co-author of Canadian Patent Act Annotated and an adjunct lecturer at the University of Toronto Faculty of Law, where he oversees the school's participation in the Harold G. Fox Intellectual Property Moot competition. Andy is a graduate of Queen's University (Science ’87 and Law ’91).",
		speakersrc: "assets/speakers/Shaughnessy.jpg"
	},
	"2 - 19:30": { // Enactus Workshop
		text: "The Queen’s division of Enactus will be running a mini pitch competition on Day 1 of the conference. Teams of delegates will be tasked with pitching a creative and out-of-the-box product/idea given by the Enactus reps! They will have time to mull over how to pitch their product/idea with the goal of getting an investment. Feedback will be provided on pitch and presentation skills. Entrepreneurs contain a diverse set of social skills that engineers would benefit from having, so the goal of this workshop is to help engineering undergrads expand their social and presentation skills! These skills will be important for later events to come!! If you’re also looking for extra-curricular opportunities, come check this workshop out to gain perspective on what the students from Enactus Queen’s do!",
		companysrc: "assets/enactus.png"
	}, 
	"2 - 21:00": { // Speaker: Hugh Cameron
		html: "<p>A native of Montreal, Canada, Hugh Cameron is a systems engineer, entrepreneur and Visiting Professor since 2010 at Makerere University’s College of Computing and Information Sciences.  He leads the college’s Software Business Incubation programme, a collaboration between the university, its local business and government partners, and other universities.  He also advises local startups on business planning, finance and operations.  Dividing his time between Canada and Uganda, he nurtures academic and practical interests in the creation of economically sustainable ventures that boost development in low-resource settings. </p><p>Prior to his time in Uganda, Hugh was an occasional academic, a career telecoms engineer and R&amp;D director at Bell-Northern Research and Nortel Networks in Canada.  While delivering pioneering telephone network management and interactive customer service applications, he also served on several scientific conference committees, international standards bodies and research grant selection panels.  After leaving Nortel, he became co-founder and CTO of a Canadian company providing outsourced medical transcription and web applications for medical departments, faculties and hospitals.  At the time of its sale in 2009, Accentus had  grown to become Canada’s largest supplier of outsourced transcription services.</p><p>Hugh received his BSc in mathematics and engineering from Queen’s University (Sci’73) and his PhD in applied mathematics from the University of Cambridge.</p>",
		speakersrc: "assets/speakers/hugh.jpg"
	},
	"2 - 22:00": { // Social at Blu Martini (19+)
		html: "<p>A chance to relax, network and hang out with your fellow delegates and speakers!</p><br><p>See the map below for directions</p>",
		map: '<iframe src="https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d2858.9596784312425!2d-76.48314713462567!3d44.22848852910578!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m13!3e2!4m5!1s0x4cd2aaf95a879fff%3A0xdb3fba468055fd81!2sDelta+Hotels+by+Marriott+Kingston+Waterfront%2C+Johnson+Street%2C+Kingston%2C+ON!3m2!1d44.228314999999995!2d-76.48040859999999!4m5!1s0x4cd2aaf94bbc94f1%3A0x377159e8703fadb3!2sBLU+Martini%2C+178+Ontario+St%2C+Kingston%2C+ON+K7L+2Y8!3m2!1d44.228869499999995!2d-76.4812839!5e0!3m2!1sen!2sca!4v1517358753059" width="80%" height="450" frameborder="0" style="border:0" allowfullscreen></iframe>',
	},
	"3 - 8:30": { // Breakfast
		text: "A continental breakfast catered by the Delta Waterfront Hotel."
	},
	"3 - 9:30": { // Speaker: Meaghan O’Reilly
		text: "Meaghan is a Scientist at Sunnybrook Research Institute and an Assistant professor for the department of medical biophysics at the University of Toronto. As a Scientist, Meaghan’s research has focused on developing systems and methods to deliver, monitor and control ultrasound therapy. In particular, she has investigated ways to map and control microbubble activity during targeted drug delivery in the brain. Her current research interests include the investigation of cavitation-mediated therapies and the adaptation of existing ultrasound therapy techniques to new treatment targets. Meaghan received her B.Sc. in mechanical engineering (Sci’07), M.Sc. in biomedical engineering from the University of Oxford, U.K. and her PhD, 2012, applied physics, University of Eastern Finland.",
		speakersrc: "assets/speakers/meaghan.jpg"
	},
	"3 - 10:30": { // CIRQUE Workshop
		text: "CIRQUE is giving you the chance to break the ice with you team before it tackles the BCG Case Study! Take this opportunity to get familiar with your teammates, while at the same time competing against other teams in a fun and interactive activity!",
		companysrc: "assets/35th-year-logo.png"
	},
	"3 - 11:30": { // BCG Case Competition
		text: "At CIRQUE 2018, BCG representatives will lead a case-study workshop giving delegates the opportunity to work in teams and put their strategic thinking to the ultimate test! The case study theme is space exploration! If you’re interested in consulting, the business industry, space, or just want to get better at case studies in an interactive session, this is an incredible opportunity! BCG representatives will also be joining us at dinners and socials, so get ready to put your networking skills to use!",
		companysrc: "assets/bcg.png"
	},
	"3 - 13:00": { // Lunch
		text: "A buffet lunch catered by the Delta Waterfront Hotel. Work on the case-study workshop may continue during this time."
	},
	"3 - 14:00": { // BCG Case Competition Continues
		text: "The BCG case workshop continues.",
		companysrc: "assets/bcg.png"
	},
	"3 - 14:30": { // Speaker: Oleg Baranov
		text: "Oleg completed his Bachelor of Mechanical Engineering at Queen's University in 2015 (Sci'15). Previously, he worked as an Engineering Intern in the Industrial Manufacturing Industry with CFN Precision, providing an opportunity to utilize his mechanical engineering knowledge. In the summer of 2014, Oleg co-founded CleanSlate UV, a medical device start-up based in Toronto. Since then, he has worked at CleanSlate as the Chief Design Officer, responsible for product development, testing, and manufacturing. Additionally, he co-founded a custom apparel company and participated heavily in FIRST Robotics Competition.",
		speakersrc: "assets/speakers/oleg.jpg"
	},
	"3 - 15:30": { // Coffee Break
		text: "A short coffee break break to shake out your bones, chat with fellow delegates and provide some time to prepare for the evening's activities!"
	},
	"3 - 16:00": { // Scotiabank Workshop
		html: "<p>CIRQUE 2018’s sponsor will be giving delegates the opportunity to participate in one of two interactive workshops! The first will be focused on Scotiabank’s international outreach. This workshop will challenge delegates to critically think about their potential for global outreach, within or outside of the field of engineering! The mot active participants will have the chance to interact directly with Scotiabank’s awesome reps, and earn free prizes!! If you are looking for a super interactive and informative session, this is the workshop for you!</p><p>Scotiabank’s second workshop gives delegates another opportunity at a pitch competition! Delegates can apply skills gained through the Enactus workshop, but this time they will be pitching their own unique stocks!! Delegates can sharpen up on skills gained the day before and put themselves in the spotlight in front of their peers and sponsorship reps! If you crave competition and want bragging rights over your peers, this is the workshop for you!</p>",
		companysrc: "assets/scotiabank.png"
	},
	"3 - 17:30": { // Presentation by Scotiabank
		text: "Sociabank is putting on a mystery presentation!",
		companysrc: "assets/scotiabank.png"
	},
	"3 - 18:00": { // Break Before Dinner
		text: "A second short break break to prepare for the evening's activities."
	},
	"3 - 18:30": { // Dinner
		text: "A 3-course meal catered by the Delta Waterfront Hotel."
	},
	"3 - 19:30": { // Speaker: Stacey Douglas
		text: "Stacey is a bilingual lawyer called to the bars of Ontario and Quebec. Her practice focuses on constitutional and administrative law, through which she handles cases dealing with civil rights, aboriginal rights and refugee claims. After obtaining dual degrees in political studies and mechanical engineering (Sci’00) at Queen’s University, Stacey worked for various NGOs and as a policy analyst with Global Affairs Canada. She is a strong advocate for gender equality and human rights. Back in 2005, she founded an NGO dedicated to educating the public on human trafficking in Canada and pushing the government for new regulations to help victims. Stacey also has an LLM from Osgoode Hall Law School, degrees in common and civil law from McGill University and an MA from RMC.",
		speakersrc: "assets/speakers/stacey.jpg"
	},
	"3 - 20:30": { // Speaker: John Gamble
		html: "<p>John Gamble is a licensed professional engineer with expertise in public policy. He is a recognized expert and spokesperson on industry issues across Canada and internationally.</p><p> Mr. Gamble’s success is built on combined experience in the public, private and not-for-profit sectors. Before joining ACEC, he held senior management and executive positions in engineering-related industry and professional associations. Prior to that, he served as a senior advisor to cabinet ministers in the Ontario provincial government. He holds a Bachelor of Science degree in civil engineering from Queen's University and spent the first 10 years of his career practicing environmental engineering in one of Canada’s most prominent consulting firms serving both public and private sector clients.</p><p>Throughout his career, John Gamble has promoted the importance of engineering to our social, economic and environmental quality of life to a wide range of industry, government, academic and public stakeholders. In 2006, he became the first recipient of the ACEC Chair's Awardfor his “exceptional contribution to the consulting engineering industry.”</p>",
		speakersrc: "assets/speakers/john.jpg"
	},
	"3 - 21:30": { // Social
		text: "A social at the Delta Waterfront Hotel"
	},
};

function affixDataToModal() {
	
}

function greyOutThePast() {
	var feb3 = $('#feb-3').children().children('tr:not(.header-cell)');
	var feb2 = $('#feb-2').children().children('tr:not(.header-cell)');
	var dt = new Date()
	var hrs = dt.getHours().toString();
	var mins = dt.getMinutes().toString();
	var day = dt.getDate();
	var year
	if (dt.getYear() != 118 || dt.getMonth() != 1)
		return;

	if (day >= 3) {
		blurPast(feb3, hrs, mins);
		blurAll(feb2);
	}
	else if (day >= 2) {
		blurPast(feb2, hrs, mins);
	}
}

function blurPast(els, hour, mins) {
	var upNext = false;
	var done = false;
	var last;

	els.each(function( index ) {
		var el = $(this);
  		var html = el.children().html();
  		var nextTime = getTime(html);
  		var lastTime;
  		if (last)
  			lastTime = getTime(last.children().html());
  		else
  			lastTime = 0;

  		var currentTime = parseInt(hour + mins);

  		if (nextTime < currentTime) {
  			el.children().css('background-color', 'rgba(0, 0, 0, 0.3)');
  		}

  		if (lastTime < currentTime && nextTime > currentTime) {
  			last.children().css('background-color', 'rgba(0, 255, 0, 0.3)');
  			done = true;
  			upNext = false;
  		}

  		last = el;
	});
}

function getTime(html) {
	var time = html.slice(0, html.indexOf(':') + 3);
  	var hour = time.slice(0, html.indexOf(":"));
  	var min = time.slice(3, time.length);
  	return parseInt(hour + min);
}

function blurAll(els) {
	els.each(function( index ) {
		$(this).children().css('background-color', 'rgba(0, 0, 0, 0.3)');
	});
}

var lastFocus;
$(function() {
	greyOutThePast();
	setInterval(greyOutThePast, 60000);
	$('tr.clickable-row').click(function() {
		renderModal(this);
		return false;
	});
	$('tr.clickable-row').keypress(function(e) {
		if (e.which == 13 || e.which == 32) {
			renderModal(this)
			return false;
		}
	})

	$('body').on('shown.bs.modal', '.modal', function () {
		lastFocus = document.activeElement;
	  	$('[id$=modal-close]').focus();
	})

	$('body').on('hide.bs.modal', '.modal', function () {
	  	$(lastFocus).focus();
	  	lastFocus = null;
	})
});

var lastLoaded = "";
function renderModal(el) {
	var time = $(el);
	var name = getCellName(el)
	if (lastLoaded == name)
		return $('#scheduleModal').modal();

	var info = payload[name];
	appendElInfoToPayload(el, info);
	clearAll();
	loadAll(info);
	$('#scheduleModal').modal();
} 

function getCellName(el) {
	var date = $(el).parent().parent()[0].id;
	var time = $(el).children().first().text();
	return date[date.length - 1] + " - " +  time;
}

function appendElInfoToPayload(elName, payload) {
	var el = $(elName);
	payload.defaultTitle = el.children().next().text();
	payload.startTime = el.children().first().text();

	end = el.next().children().first().text(); 
	payload.endTime = end ? end : "23:59";
}

function clearAll() {
	var txt = $('#body-text-target').html('');
	var map = $('#map-target').html('');
	var img = $('#modal-img-target').html('');
}

function loadAll(payload) {
	var title = $('#schd-modal-title');
	var txt = $('#body-text-target');
	var map = $('#map-target');
	var img = $('#modal-img-target');
	var times = $('#time-target').html(payload.startTime + "-" + payload.endTime);
	
	if (payload.title)
		title.html(payload.title);
	else
		title.html(payload.defaultTitle);

	if (payload.map)
		map.html(payload.map);

	if (payload.html)
		txt.html(payload.html);
	else
		txt.html("<p>" + payload.text + "</p>")

	if (payload.companysrc)
		img.html("<img src='" + payload.companysrc + "' class='modal-img' alt='" + payload.title +"'><br><br>");
	else if (payload.doublesrc)
		img.html("<img src='assets/team/bae.jpg' class='modal-img-small super-rounded' alt='Benigna Ahsan'>" +
			"<img src='assets/team/j_l.jpg' class='modal-img-small super-rounded' alt='Jamie-Lee Freeston'>");
	else if (payload.speakersrc)
		img.html("<img src='" + payload.speakersrc + "' class='modal-img rounded' alt='" + payload.title +"'>");

}	